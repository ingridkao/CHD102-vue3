<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ë≥ºÁâ©Ëªä</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@500;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="carts/index.css">
    <link rel="stylesheet" href="carts/products.css">
    <link rel="stylesheet" href="carts/info.css">
</head>
<body>
    <div id="app">
        <div class="commom wrapper">
            <main class="tabs">
                <div class="tabsList">
                    <div class="commom tabsItem"
                        v-for="(item, key) in tabItems"
                        :class="{active: key == tabActive}"
                        @click="updateTab(key)"
                    >
                        {{item}}
                    </div>
                </div>
                <div class="commom tabsContent">
                    <div v-if="tabActive == 1">   
                        <input 
                            type="text" 
                            v-model="search"
                            @input="searchProduct"
                        />
                        <button @click="resetProduct">X</button>
                        <button @click="search = 'Êßç'">#Êßç</button>
                        <div 
                            v-for="(item, index) in productList" 
                            :key="item.id" 
                            class="products"
                            @click="updateTarget(item)"
                        >
                            <img :src="`carts/img/${item.id}.png`" :alt="item.name">   
                            <div class="commom box">
                                <div class="box-info">
                                    <h6>
                                        {{item.name}}
                                    </h6>
                                    <div class="row">
                                        {{item.stock}}
                                    </div>
                                </div>
                                <div class="box-price">
                                    <div class="row">
                                        üí∞
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div v-else-if="tabActive == 2" class="tabsWrapper">
                        <div 
                            v-for="(item, index) in cartList" 
                            :key="item.id" 
                            class="products"
                        >
                            <img :src="`carts/img/${item.id}.png`" :alt="item.name">   
                            <div class="commom box">
                                <div class="box-info">
                                    <h6>
                                        {{item.name}}
                                    </h6>
                                    <div class="row">
                                        <button class="arrow left" @click="reduceCart(index)"></button>
                                        <input type="number" v-model="item.count" class="commom"/>
                                        <button class="arrow right" @click="addCart(index)"></button>
                                    </div>
                                </div>
                                <div class="box-price">
                                    <h6>
                                        üí∞{{parseNumerDisplay(item.price)}}
                                    </h6>
                                    <div class="row">
                                        üí∞{{parseNumerDisplay(item.price*item.count)}}
                                        <button class="remove" @click="removeCart(index)"></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            <aside>
                <div class="info" v-if="tabActive == 1">
                    <div>
                        <div v-if="target && target.id" class="commom info_desc">
                            {{target.desc}}
                        </div>
                    </div>
                </div>

                <div class="info checkout" v-else>
                    <div>
                        <div class="row">
                            <h6 class="info_label">Á∏ΩÂÖ±</h6>
                            <div>üí∞<span class="commom price">{{parsePrice}}</span></div>
                        </div>
                    </div>
                    <button class="commom commit">ÁµêÂ∏≥</button>
                </div>
            </aside>
        </div>
    </div>

    <script src="vue.global.js"></script>
    <script src="carts/data.js"></script>
    <script src="carts/cartList.js"></script>
    <script>
        const App = Vue.createApp({
            data() {
                return {
                    tabActive: 1,
                    tabItems: {
                        1: 'ÂïÜÂìÅ',
                        2: 'Ë≥ºÁâ©Ëªä',
                        3: 'XXX',
                    },
                    //Â∞áË≥ºÁâ©ËªäÊ∏ÖÂñÆÂÖàÊîæÂú®Â§ñjs -> carts/cartList.js
                    // cartList,
                    cartList: cartList,
                    productList: products,
                    target: {},
                    search: ''
                }
            },
            computed: {
                parsePrice(){
                    if(this.cartList.length === 0) return `0Êñá`
                    //ÂØ´Ê≥ï‰∏Ä
                    let total = 0
                    for (let index = 0; index < this.cartList.length; index++) {
                        const accumulator = this.cartList[index]['price'] * this.cartList[index]['count']
                        total += accumulator 
                    }
                    //ÂØ´Ê≥ï‰∫å
                    // const total = this.cartList.reduce((accumulator, currentValue) =>{
                    //     return accumulator + (currentValue.price * currentValue.count)
                    // }, 0) // initialValue
                    return this.parseNumerDisplay(total)
                }
            },
            methods: {
                searchProduct(){
                    // console.log(this.search);
                    // const res1 = products.filter((item) => {
                    //     return item.name.includes('‰∏É')
                    // })
            
                    // ÁØ©ÈÅ∏ÁµêÊûúÂõûÂÇ≥Áµ¶product
                    this.productList = products.filter((item) => {
                        // item.nameÂÆåÂÖ®ÊØîÂ∞çsearch
                        // return item.name === this.search
                        // item.nameÊ®°Á≥äÊØîÂ∞çsearch
                        return item.name.includes(this.search)
                        // ÊâæÂá∫Â∫´Â≠ò>search
                        // return item.stock > Math.round(this.search)
                    })
                    // console.log(res)
                },
                resetProduct(){
                    this.search = ''
                    this.productList = products
                },
                updateTarget(item){
                    this.target = item
                },
                // ÂàáÊèõtab
                updateTab (index) {
                    this.tabActive = index
                },
                // ËΩâÊèõË≤®Âπ£
                parseNumerDisplay(num){
                    const main = Math.round(num/1000)
                    const sub = num%1000
                    if(main> 0)return `${main}ÂÖ©${sub}Êñá`
                    return `${sub}Êñá`
                },
                reduceCart(index){
                    //Á¶ÅÊ≠¢Ë≥ºÁâ©ËªäÊï∏Èáè<0
                    if(this.cartList[index]['count'] == 0) return
                    this.cartList[index]['count'] -= 1
                },
                addCart(index){
                    //Á¶ÅÊ≠¢Ë≥ºÁâ©ËªäÊï∏Èáè>ÂïÜÂìÅÂ∫´Â≠òÊï∏Èáè
                    if(this.cartList[index]['count'] === this.cartList[index]['stock']) return
                    this.cartList[index]['count']+= 1
                },
                removeCart(index){
                    this.cartList.splice(index, 1)
                }
            }
        })

        App.mount('#app')
    </script>
</body>
</html>